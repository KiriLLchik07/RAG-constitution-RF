# Разработка RAG-системы для работы с правовой базой знаний

## Этап 1. Формирование технологического стека

Для реализации RAG-системы выбран следующий технологический стек.

1.  `sentence-transformers/deepvk/USER-bge-m3` - модель для формирование контекстуальных эмбеддингов текстовых документов;
2.  `Mistral-7B-Instruct-v0.2` - LLM и средство взаимодействия с LLM;
3.  `ChromaDB` - векторная база данных;
4.  `LangChain` - фреймворк для связывания компонентов системы;
5.  `FastAPI` - фреймворк для разработки API системы;
6.  `Streamlit` - средство реализации web-интерфейса;
7.  `qilowoq/bge-reranker-v2-m3-en-ru` - реранкер для переранжирования отобранных релевантных документов.

## Этап 2. Работа с базой знаний

Данный этап включал в себя следующие задачи:

1. Загрузка файла формата .docx. Анализ структуры документа. Определение минимальной единицей текста в документе (**статья**).
2. Чанкирование текстового документа. Чанкирование производилось по **статьям** конституции РФ.
3. Векторизация чанков. Процесс векторизации осуществлялся с использованием модели `deepvk/USER-bge-m3`.
4. Сохранение полученных эмбеддингов в векторну БД `ChromaDB`.

## Этап 3. Формирование запроса к LLM и промпт-engineering

- На этом этапе был сформирован пайплайн по отбору релевантных документов из базы знаний в соответствие с запросом пользователя.
- Для переранжирования отобранных релевантных документов был выбран реранкер `qilowoq/bge-reranker-v2-m3-en-ru`.
- Сформирован системный промпт, который решает задачу поиска релевантных документов по запросу пользователя. В качестве обязательных параметров были указаны :

  - роль модели LLM;
  - исходный запрос пользователя;
  - информацию об отобранных документах;
  - информацию о метаданных;
  - установки для ответа.

- В результате был создан функционал по обращению к LLM с системным промптом, запросом пользователя и отобранным контекстом.

## Этап 4. Разработка API

На четвертом этапе построения сервиса был разработан API для получения результата работы LLM. API состоял из двух эндпоинтов:

- `/health`: проверяет работоспособность API;
- `/ask`: получает вопрос пользователя и на выходе выдает ответ с источниками и метаданными.

## Этап 5. Разработка Web-интерфейса

В качестве Web-интерфейса был выбран фреймворк `Streamlit`, с помощью которого пользователь может ввести запрос и получить ответ из базы знаний. В качестве дополнительного функционала была реализована история чата.
